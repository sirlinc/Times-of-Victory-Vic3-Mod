namespace = french_pretenders_pulse

# The [Dynasty] World
french_pretenders_pulse.1 = {
	type = country_event
	placement = ROOT
	title = french_pretenders_pulse.1.t
	desc = french_pretenders_pulse.1.d
	flavor = french_pretenders_pulse.1.f

	duration = 3

	dlc = dlc004

	icon = "gfx/interface/icons/event_icons/event_newspaper.dds"
	gui_window = event_window_1char_tabloid

	left_icon = scope:french_royalist_writer

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	cooldown = { months = normal_modifier_time }

	trigger = {
		any_interest_group = {
			leader = {
				NOT = { has_modifier = popular_royalist_writer }
				OR = {
					AND = {
						has_ideology = ideology:ideology_orleanist
						owner = {
							has_variable = orleanist_restoration_var
						}
					}
					AND = {
						has_ideology = ideology:ideology_legitimist
						owner = {
							has_variable = legitimist_restoration_var
						}
					}
					AND = {
						has_ideology = ideology:ideology_bonapartist
						owner = {
							has_variable = bonapartist_restoration_var
						}
					}
				}
				OR = {
					has_trait = charismatic
					has_trait = inspirational_orator
					has_trait = demagogue
					has_trait = firebrand
				}
			}
		}
	}

	immediate = {
		random_interest_group = {
			limit = {
				leader = {
					NOT = { has_modifier = popular_royalist_writer }
					OR = {
						AND = {
							has_ideology = ideology:ideology_orleanist
							owner = {
								has_variable = orleanist_restoration_var
							}
						}
						AND = {
							has_ideology = ideology:ideology_legitimist
							owner = {
								has_variable = legitimist_restoration_var
							}
						}
						AND = {
							has_ideology = ideology:ideology_bonapartist
							owner = {
								has_variable = bonapartist_restoration_var
							}
						}
					}
					OR = {
						has_trait = charismatic
						has_trait = inspirational_orator
						has_trait = demagogue
						has_trait = firebrand
					}
				}
			}
			save_scope_as = french_royalist_writer_ig
			leader = {
				save_scope_as = french_royalist_writer
			}
		}
	}

	option = {
		name = french_pretenders_pulse.1.a
		default_option = yes

		custom_tooltip = {
			text = french_pretenders_pulse_advance_by_fifteen_percent_tt
			change_variable = {
				name = french_dynastic_primary_progress_var
				add = 18
			}
		}
	}

	option = {
		name = french_pretenders_pulse.1.b
		trigger = {
			OR = {
				has_law = law_type:law_outlawed_dissent
				has_law = law_type:law_censorship
			}
		}
		custom_tooltip = {
			text = french_pretenders_pulse_advance_by_twenty_five_percent_tt
			change_variable = {
				name = french_dynastic_primary_progress_var
				add = 30
			}
		}
	}
	option = {
		name = french_pretenders_pulse.1.c
		scope:french_royalist_writer = {
			add_modifier = {
				name = popular_royalist_writer
				months = short_modifier_time
			}		
		}
		add_modifier = {
			name = popular_royalist_book
			months = short_modifier_time
		}
		custom_tooltip = {
			text = french_pretenders_pulse_advance_by_five_percent_tt
			change_variable = {
				name = french_dynastic_primary_progress_var
				add = 6
			}
		}
	}
}

# Fidelity & Perjury
french_pretenders_pulse.2 = {
	type = country_event
	placement = ROOT
	title = french_pretenders_pulse.2.t
	desc = french_pretenders_pulse.2.d
	flavor = french_pretenders_pulse.2.f

	duration = 3

	dlc = dlc004

	event_image = {
		video = "votp_monarch_holding_court"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	cooldown = { months = normal_modifier_time }

	icon = "gfx/interface/icons/event_icons/event_election.dds"

	trigger = {
		has_variable = french_monarchist_progress_var
		var:french_monarchist_progress_var > 5 # sanity check to prevent negative values from the options

		any_interest_group = {
			is_in_government = yes
			NOT = { has_modifier = upset_royalist_hardliners }
			leader = { 
				OR = {
					has_ideology = ideology:ideology_orleanist 
					has_ideology = ideology:ideology_legitimist
					has_ideology = ideology:ideology_bonapartist
				}
			}
		}
	}

	immediate = {
		random_interest_group = {
			limit = {
				is_in_government = yes
				NOT = { has_modifier = upset_royalist_hardliners }
				leader = { 
					OR = {
						has_ideology = ideology:ideology_orleanist 
						has_ideology = ideology:ideology_legitimist
						has_ideology = ideology:ideology_bonapartist
					}
				}
			}
			save_scope_as = royalist_hardliners
		}
	}

	option = {
		name = french_pretenders_pulse.2.a
		default_option = yes

		custom_tooltip = {
			text = french_pretenders_pulse_back_by_fifteen_percent_tt
			change_variable = {
				name = french_monarchist_progress_var
				add = -9
			}
		}
	}

	option = {
		name = french_pretenders_pulse.2.b

		scope:royalist_hardliners = {
			add_modifier = {
				name = upset_royalist_hardliners
				months = normal_modifier_time				
			}
		}
		custom_tooltip = {
			text = french_pretenders_pulse_back_by_five_percent_tt
			change_variable = {
				name = french_monarchist_progress_var
				add = -3
			}
		}
	}
}

# Strange Bedfellows
french_pretenders_pulse.3 = {
	type = country_event
	placement = ROOT
	title = french_pretenders_pulse.3.t
	desc = french_pretenders_pulse.3.d
	flavor = french_pretenders_pulse.3.f

	duration = 3

	dlc = dlc004

	event_image = {
		video = "votp_monarch_holding_court"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	cooldown = { months = normal_modifier_time }

	icon = "gfx/interface/icons/event_icons/event_election.dds"

	trigger = {
		has_law = law_type:law_monarchy

		OR = {
			AND = {
				any_interest_group = {
					leader = { has_ideology = ideology:ideology_orleanist }
					is_in_government = no
					is_marginal = no
					NOR = {
						has_modifier = solidarity_in_opposition
						has_modifier = alone_with_principles
					}
				}
				NOT = {
					has_variable = orleanist_restoration_var
				}
			}
			AND = {
				any_interest_group = {
					leader = { has_ideology = ideology:ideology_legitimist }
					is_in_government = no
					is_marginal = no
					NOR = {
						has_modifier = solidarity_in_opposition
						has_modifier = alone_with_principles
					}
				}
				NOT = {
					has_variable = legitimist_restoration_var
				}
			}
			AND = {
				any_interest_group = {
					leader = { has_ideology = ideology:ideology_bonapartist }
					is_in_government = no
					is_marginal = no
					NOR = {
						has_modifier = solidarity_in_opposition
						has_modifier = alone_with_principles
					}
				}
				NOT = {
					has_variable = bonapartist_restoration_var
				}
			}
		}
		any_interest_group = {
			is_in_government = no
			is_marginal = no
			AND = {
				law_stance = {
					law = law_type:law_presidential_republic
					value > neutral
				}
				law_stance = {
					law = law_type:law_parliamentary_republic
					value > neutral
				}
				law_stance = {
					law = law_type:law_monarchy
					value < neutral
				}
			}
		}
	}

	immediate = {
		random_interest_group = {
			limit = {
				OR = {
					AND = {
						leader = { has_ideology = ideology:ideology_orleanist }
						is_in_government = no
						owner = { NOT = { has_variable = orleanist_restoration_var } }
					}
					AND = {
						leader = { has_ideology = ideology:ideology_legitimist }
						is_in_government = no
						owner = { NOT = { has_variable = legitimist_restoration_var } }
					}
					AND = {
						leader = { has_ideology = ideology:ideology_bonapartist }
						is_in_government = no
						owner = { NOT = { has_variable = bonapartist_restoration_var } }
					}
				}
			}
			save_scope_as = monarchists_in_opposition
		}
		random_interest_group = {
			limit = {
				is_in_government = no
				is_marginal = no
				AND = {
					law_stance = {
						law = law_type:law_presidential_republic
						value > neutral
					}
					law_stance = {
						law = law_type:law_parliamentary_republic
						value > neutral
					}
					law_stance = {
						law = law_type:law_monarchy
						value < neutral
					}
				}
			}
			save_scope_as = republicans_in_opposition
		}
	}


	option = {
		name = french_pretenders_pulse.3.a
		default_option = yes
		scope:monarchists_in_opposition = {
			add_modifier = {
				name = solidarity_in_opposition
				months = normal_modifier_time
			}
			leader = {
				set_variable = monarchist_working_with_republicans
			}
		}
		scope:republicans_in_opposition = {
			add_modifier = {
				name = solidarity_in_opposition
				months = normal_modifier_time
			}
			leader = {
				set_variable = republican_working_with_monarchists
			}
		}
		custom_tooltip = {
			text = french_pretenders_pulse_advance_by_fifteen_percent_tt
			change_variable = {
				name = french_monarchist_progress_var
				add = 9
			}
		}
	}


	option = {
		name = french_pretenders_pulse.3.b

		scope:monarchists_in_opposition = {
			add_modifier = {
				name = alone_with_principles
				months = normal_modifier_time
			}
		}
		scope:republicans_in_opposition = {
			add_modifier = {
				name = alone_with_principles
				months = normal_modifier_time
			}
		}
		custom_tooltip = {
			text = french_pretenders_pulse_advance_by_five_percent_tt
			change_variable = {
				name = french_monarchist_progress_var
				add = 3
			}
		}
	}

	option = {
		name = french_pretenders_pulse.3.c

		scope:monarchists_in_opposition = {
			add_modifier = {
				name = collaboration_collapsed
				months = normal_modifier_time
			}
		}
		scope:republicans_in_opposition = {
			add_modifier = {
				name = collaboration_collapsed
				months = normal_modifier_time
			}
		}
		custom_tooltip = {
			text = french_pretenders_pulse_back_by_five_percent_tt
			change_variable = {
				name = french_monarchist_progress_var
				add = -3
			}
		}
	}
}

# Republican Apostasy
french_pretenders_pulse.4 = {
	type = country_event
	placement = ROOT
	title = french_pretenders_pulse.4.t
	desc = french_pretenders_pulse.4.d
	flavor = french_pretenders_pulse.4.f

	duration = 3

	dlc = dlc004

	event_image = {
		video = "votp_monarch_holding_court"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	cooldown = { months = normal_modifier_time }

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	trigger = {
		var:french_dynastic_primary_progress_var > 5 # sanity check to prevent negative values from the options
		any_interest_group = {
			is_in_government = yes
			OR = {
				AND = {
					leader = {
						has_variable = monarchist_working_with_republicans
						has_ideology = ideology:ideology_orleanist
					}
					owner = {
						has_variable = orleanist_restoration_var
					}
				}
				AND = {
					leader = {
						has_variable = monarchist_working_with_republicans
						has_ideology = ideology:ideology_legitimist
					}
					owner = {
						has_variable = legitimist_restoration_var
					}
				}
				AND = {
					leader = {
						has_variable = monarchist_working_with_republicans
						has_ideology = ideology:ideology_bonapartist
					}
					owner = {
						has_variable = bonapartist_restoration_var
					}
				}
			}
		}
		any_interest_group = {
			leader = {
				has_variable = republican_working_with_monarchists
				is_busy = no
			}	
			AND = {
				law_stance = {
					law = law_type:law_presidential_republic
					value > neutral
				}
				law_stance = {
					law = law_type:law_parliamentary_republic
					value > neutral
				}
				law_stance = {
					law = law_type:law_monarchy
					value < neutral
				}
			}
			OR = { # only pick IGs that are valid for both republicanism and the monarchist ideologies
				is_interest_group_type = ig_armed_forces
				is_interest_group_type = ig_petty_bourgeoisie
				is_interest_group_type = ig_industrialists
			}	
		}
	}

	immediate = {
		random_interest_group = {
			limit = {
				is_in_government = yes
				OR = {
					AND = {
						leader = {
							has_variable = monarchist_working_with_republicans
							has_ideology = ideology:ideology_orleanist
						}
						owner = {
							has_variable = orleanist_restoration_var
						}
					}
					AND = {
						leader = {
							has_variable = monarchist_working_with_republicans
							has_ideology = ideology:ideology_legitimist
						}
						owner = {
							has_variable = legitimist_restoration_var
						}
					}
					AND = {
						leader = {
							has_variable = monarchist_working_with_republicans
							has_ideology = ideology:ideology_bonapartist
						}
						owner = {
							has_variable = bonapartist_restoration_var
						}
					}
				}
			}
			save_scope_as = monarchist_french_ig
			leader = {
				save_scope_as = monarchist_french_ig_leader
			}
		}
		random_interest_group = {
			limit = {
				leader = {
					has_variable = republican_working_with_monarchists
					is_busy = no
				}	
				AND = {
					law_stance = {
						law = law_type:law_presidential_republic
						value > neutral
					}
					law_stance = {
						law = law_type:law_parliamentary_republic
						value > neutral
					}
					law_stance = {
						law = law_type:law_monarchy
						value < neutral
					}
				}
				OR = { # only pick IGs that are valid for both republicanism and the monarchist ideologies
					is_interest_group_type = ig_armed_forces
					is_interest_group_type = ig_petty_bourgeoisie
					is_interest_group_type = ig_industrialists
				}	
			}
			save_scope_as = republican_french_ig
			save_scope_as = memento_mori_ig # to reuse the retirement notification
			leader = {
				save_scope_as = republican_french_ig_leader
				save_scope_as = memento_mori_leader # to reuse the retirement notification
			}
		}
	}


	option = {
		name = french_pretenders_pulse.4.a
		default_option = yes

		if = {
			limit = {
				scope:monarchist_french_ig_leader = {
					has_ideology = ideology:ideology_orleanist
				}
			}
			scope:republican_french_ig_leader = {
				set_ideology = ideology:ideology_orleanist
			}
		}
		else_if = {
			limit = {
				scope:monarchist_french_ig_leader = {
					has_ideology = ideology:ideology_legitimist
				}
			}
			scope:republican_french_ig_leader = {
				set_ideology = ideology:ideology_legitimist
			}
		}
		else_if = {
			limit = {
				scope:monarchist_french_ig_leader = {
					has_ideology = ideology:ideology_bonapartist
				}
			}
			scope:republican_french_ig_leader = {
				set_ideology = ideology:ideology_bonapartist
			}
		}


		custom_tooltip = {
			text = french_pretenders_pulse_advance_by_twenty_five_percent_tt
			change_variable = {
				name = french_dynastic_primary_progress_var
				add = 30
			}
		}
	}

	option = {
		name = french_pretenders_pulse.4.b

		post_notification = ig_leader_memento_mori
		custom_tooltip = {
			text = french_pretenders_pulse.4.b.tt
			hidden_effect = {
				scope:republican_french_ig_leader = {
					kill_character = {
						hidden = yes
					}
				}
			}
		}
		scope:republican_french_ig = {
			add_modifier = {
				name = cryptomonarchists_in_our_ranks
				months = normal_modifier_time
			}
		}

		custom_tooltip = {
			text = french_pretenders_pulse_back_by_fifteen_percent_tt
			change_variable = {
				name = french_dynastic_primary_progress_var
				add = -18
			}
		}
	}
}

# The Eternal House of [house]
french_pretenders_pulse.5 = {
	type = country_event
	placement = ROOT
	title = french_pretenders_pulse.5.t
	desc = french_pretenders_pulse.5.d
	flavor = french_pretenders_pulse.5.f

	duration = 3

	dlc = dlc004

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"
	gui_window = event_window_1char_tabloid

	left_icon = scope:monarch_of_france

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	# Triggered by completing the Cement the Dynasty JE

	immediate = {
		ruler = {
			save_scope_as = monarch_of_france
		}
	}

	option = {
		name = french_pretenders_pulse.5.a
		default_option = yes

		custom_tooltip = {
			text = french_pretenders_the_dynasty_is_secure
		}

		scope:monarch_of_france = {
			add_modifier = {
				name = restitutor_orbis
				months = normal_modifier_time
			}		
		}
	}

	option = {
		name = french_pretenders_pulse.5.b

		custom_tooltip = {
			text = french_pretenders_the_dynasty_is_secure
		}
		every_interest_group = {
			limit = {
				OR = {
					AND = {
						leader = { has_ideology = ideology:ideology_orleanist }
						owner = { has_variable = orleanist_restoration_var }
					}
					AND = {
						leader = { has_ideology = ideology:ideology_legitimist }
						owner = { has_variable = legitimist_restoration_var }
					}
					AND = {
						leader = { has_ideology = ideology:ideology_bonapartist }
						owner = { has_variable = bonapartist_restoration_var }
					}
				}
			}
			add_modifier = {
				name = stalwarts_of_the_restoration
				months = normal_modifier_time
			}
		}
	}
}
